<!DOCTYPE html>
<html>
  <head>
    <title>SSE Demo</title>
    <meta charset="utf-8" />
    <style>
      #StockData{
        border: solid black;
        border-collapse: collapse;
        
      }
      tr td {
        border: solid black;
        border-collapse: collapse;
        padding: 10px;
        width: 80px;
        height: 40px;
      }
      th {
        border: solid black;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <script src="react/react.js"></script>
    <script src="react/react-dom.js"></script>
    <script src="react/babel.js"></script>
    <script type="text/babel">

      const useState = React.useState;
      const useEffect = React.useEffect;
      
      function App() {
	  //const [time, setTime] = useState({ticker: 'AMZN', name: 'Amazon', price: 281, volume: 122});
    const [time, setTime] = useState(" ");
	  useEffect(() => {
              const eventSource = new EventSource('http://localhost:31415/stocks');
              eventSource.onmessage = (event) => {
      console.log(event);
		  const data = JSON.parse(event.data);
      console.log(data.ticker);
      if (data.ticker == "AMZN"){
        document.getElementById("AMZN price").innerHTML    = "$" + data.price;
        document.getElementById("AMZN volume").innerHTML   = data.volume + " units";
      } else if (data.ticker == "IBM"){
        document.getElementById("IBM price").innerHTML     = "$" + data.price;
        document.getElementById("IBM volume").innerHTML    = data.volume + " units";
      } else if (data.ticker == "DOW"){
        document.getElementById("DOW price").innerHTML     = "$" + data.price;
        document.getElementById("DOW volume").innerHTML    = data.volume + " units";
      } else if (data.ticker == "NASDAQ"){
        document.getElementById("NASDAQ price").innerHTML  = "$" + data.price;
        document.getElementById("NASDAQ volume").innerHTML = data.volume + " units";
      }
		  setTime(data);
              };
              return () => eventSource.close();
	  }, []);
	  return (
		  <div>
		  <h1>Stock Data</h1>
		  <p>Current Ticker: {time.ticker}</p>
      <p>Current Name:   {time.name}</p>
      <p>Current Price:  {time.price}</p>
      <p>Current Volume: {time.volume}</p>

      <table id="StockData">
      <thead>
        <tr>
          <th>Ticker</th>
          <th>Name</th>
          <th>Last Trade Price</th>
          <th>Last Trade Volume</th>
          <th>Trends</th>
        </tr>
      </thead>
      <tbody>
        <tr id="AMZNstocks">
          <td>AMZN</td>
          <td>Amazon</td>
          <td id="AMZN price">Awaiting Price</td>
          <td id="AMZN volume">Awaiting Volume</td>
        </tr>
        <tr id="DOWstocks">
          <td>DOW</td>
          <td>Dow Jones Industrial Average</td>
          <td id="DOW price">Awaiting Price</td>
          <td id="DOW volume">Awaiting Volume</td>
        </tr>
        <tr id="IBMstocks">
          <td>IBM</td>
          <td>International Business Machines</td>
          <td id="IBM price">Awaiting Price</td>
          <td id="IBM volume">Awaiting Volume</td>
        </tr>
        <tr id="NASDAQstocks">
          <td>NASDAQ</td>
          <td>Nasdaq Composite</td>
          <td id="NASDAQ price">Awaiting Price</td>
          <td id="NASDAQ volume">Awaiting Volume</td>
        </tr>
      </tbody>
      </table>
		  </div>
	  );
      }
      ReactDOM.render(
              <App />,
	  document.getElementById('app'));
    </script>
  </body>
</html>
